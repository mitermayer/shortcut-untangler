machine:
    environment:
        COVERALLS_REPO_TOKEN: vndJ1K12F91n0HswPDxz3fqfSFug5QQ0t
        COVERALLS_SERVICE_NAME: circleci
        COVERALLS_REPO_TOKEN: $COVERALLS_REPO_TOKEN
        COVERALLS_SERVICE_JOB_ID: $CIRCLE_BUILD_NUM
        COVERALLS_GIT_COMMIT: $CIRCLE_SHA1
        COVERALLS_GIT_BRANCH: $CIRCLE_BRANCH

test:
  pre:
    - npm install -g karma
    - npm install -g gulp
    - npm install coveralls
  override:
    - npm test
  post:
    - find $CIRCLE_ARTIFACTS/coverage/ -name lcov.info -exec cat {} \; | ./node_modules/coveralls/bin/coveralls.js

