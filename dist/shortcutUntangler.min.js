!function(e,t){"function"==typeof define&&define.amd?define([],t):e.ShortcutUntangler=t()}(this,function(){var e,t,n,r,i;return e=function(){"use scrict";var e=["alt","ctrl","shift"],t={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},n=function(){},r=function(e){return Array.isArray(e)},i=function(e){return"number"==typeof e},a=function(e){return"string"==typeof e},o=function(e,t){return e.every(function(e){return"undefined"!=typeof t[e]})};return{KEY_MODIFIERS:e,MODFIER_KEY_CODES:t,addEvent:n,isString:a,isArray:r,isNumber:i,hasRequiredArguments:o}}(),t=function(e){var t={getKeyName:function(t){return e.isNumber(t)?t=e.MODFIER_KEY_CODES[t]||String.fromCharCode(t):-1!==t.indexOf(" ")&&(t=t.toLowerCase().split(" ").filter(function(e){return e}).sort().join("+")),t.toUpperCase()},validate:function(t,n){if(n[t.key])throw new Error('Shortcut key "'+t.key+'" is already set on context this context');if(!t||!e.hasRequiredArguments(["key","callback"],t))throw new Error("InvalidArguments");return!0},create:function(e){var t={key:e.key,description:e.description||"Keyboard shortcut handler triggered by key: "+e.key,name:e.name||"Shortcut for: "+e.key,callback:e.callback};return Object.defineProperty(t,"toggleDisabledState",{value:function(e){e="undefined"!=typeof e?e:!this.disabled,e?this.disabled=!0:delete this.disabled},writable:!1,enumerable:!1,configurable:!1}),t}};return t}(e),n=function(e){var t=function(e,t){for(var n,r=0,i=0,a=e.length;a>i;i++)if(n=e[i],n.name===t){r=i;break}return r},n={getContextIndex:t,validate:function(n,r){var i=r.context[t(r.context,n.name)];if(i&&i.name===n.name)throw new Error('Context name "'+n.name+'" is already set on environment "'+r.name+'"');if(!n||!e.hasRequiredArguments(["name"],n))throw new Error("InvalidArguments");return!0},create:function(t){var n={shortcut:{},name:t.name,weight:t.weight||0};return Object.defineProperty(n,"toggleDisabledState",{value:function(t,n){var r;if(e.isArray(n))for(var i=0,a=n.length;a>i;i++)r=this.shortcut[n[i]],"undefined"!=typeof r&&r.toggleDisabledState(t);else if(e.isString(n))r=this.shortcut[n],"undefined"!=typeof r&&r.toggleDisabledState(t);else for(r in this.shortcut)this.shortcut[r].toggleDisabledState(t)},writable:!1,enumerable:!1,configurable:!1}),n}};return n}(e),r=function(e){var t={validate:function(t,n){if(n[t.name])throw new Error('Environment name "'+t.name+'" is already set');if(!t||!e.hasRequiredArguments(["name"],t))throw new Error("InvalidArguments");return!0},create:function(t){var n={context:[],name:t.name};return Object.defineProperty(n,"toggleDisabledState",{value:function(t,n,r){var i;if(e.isArray(n))for(var a=0,o=this.context.length;o>a;a++)i=this.context[a],-1!==n.indexOf(i.name)&&i.toggleDisabledState(t,r);else if(e.isString(n))for(var f=0,s=this.context.length;s>f;f++)i=this.context[f],i.name===n&&i.toggleDisabledState(t,r);else for(var u=0,c=this.context.length;c>u;u++)i=this.context[u],i.toggleDisabledState(t,r)},writable:!1,enumerable:!1,configurable:!1}),n}};return t}(e),i=function(e,t,n,r){var i=e.KEY_MODIFIERS,a=e.MODFIER_KEY_CODES,o=function(){},f=function(e,t){for(var n,r=e.length,i=t.weight,a=e.length-1;a>=0;a--){if(n=e[a],i===n.weight){r=a+1;break}if(i<n.weight){r=a;break}}return r},s=function(e){for(var t={},n=e.context.length-1;n>=0;n--){var r,i=e.context[n].shortcut;for(r in i){var a=i[r];t[r]||a.disabled||(t[r]=a)}}return t},u=function(u){u=u||{};var c=u.mainEnvironment||"main",l=u.mainContext||"main",d=c,h=!1||u.debug,g=u.rootElement||document.getElementsByTagName("body")[0],m={},v={ENVIRONMENT:{}},y=function(){var e={};return{getKeys:function(){return Object.keys(e).sort().join("+")},keyDown:function(t){e[t]=!0},keyUp:function(t){delete e[t]},clear:function(){e={}}}}();this.changeEnvironment=function(e){m[e]&&(d=e)},this.debugMode=function(e){h="undefined"!=typeof e?e:!0},this.toggleDisabledState=function(t,n,r,i){var a;if(e.isArray(n))for(var o=0,f=n.length;f>o;o++)a=m[n[o]],"undefined"!=typeof a&&(a.toggleDisabledState(t,r,i),v.ENVIRONMENT[a.name]=this.toJSON(a.name));else if(e.isString(n))a=m[n],"undefined"!=typeof a&&(a.toggleDisabledState(t,r,i),v.ENVIRONMENT[a.name]=this.toJSON(a.name));else for(a in m)m[a].toggleDisabledState(t,r,i),v.ENVIRONMENT[a]=this.toJSON(a)},this.getActiveEnvironment=function(){return d},this.toJSON=function(t){var n={};if(e.isString(t))n="undefined"!=typeof m[t]?s(m[t]):n;else if(e.isArray(t)){n=[];for(var r=0,i=t.length;i>r;r++)n.push(s(m[t[r]]))}else if(t===!0){n=[];for(var a in m)n.push(s(m[a]))}else n=s(m[d]);return n},this.createContext=function(e,t){var r,i,a=m[t]||m[this.getActiveEnvironment()];n.validate(e,a),i=a.context,r=n.create(e),i.splice(f(i,r),0,r),v.ENVIRONMENT[a.name]=this.toJSON(a.name)},this.createEnvironment=function(e,t){var n,i="undefined"!=typeof t?t:c;r.validate(e,m),n=r.create(e),m[e.name]=n,this.createContext({name:l},e.name),i!==!1&&(n.context[0].shortcut=this.toJSON(i)),v.ENVIRONMENT[n.name]=this.toJSON(n.name)},this.createShortcut=function(e,r,i){var a=m[i||this.getActiveEnvironment()],o=n.getContextIndex(a.context,r),f=a.context[o].shortcut;e.key=t.getKeyName(e.key),t.validate(e,f),f[e.key]=t.create(e),v.ENVIRONMENT[a.name]=this.toJSON(a.name)},this.createEnvironment({name:d}),g.addEventListener("blur",function(){y.clear()}),g.addEventListener("keyup",function(e){for(var t=e.keyCode?e.keyCode:e.which,n="undefined"!=typeof a[t]?a[t].toUpperCase():String.fromCharCode(t),r=0,o=i.length;o>r;r++){var f=i[r];e[f+"Key"]||y.keyUp(f.toUpperCase())}y.keyUp(n)},!1),g.addEventListener("keydown",function(t){var n,r,a=t.keyCode?t.keyCode:t.which,f="undefined"!=typeof e.MODFIER_KEY_CODES[a]?e.MODFIER_KEY_CODES[a].toUpperCase():String.fromCharCode(a),s=v.ENVIRONMENT[d];if(y.keyDown(f),-1===i.indexOf(f.toLowerCase()))for(var u=0,c=i.length;c>u;u++){var l=i[u];t[l+"Key"]&&y.keyDown(l.toUpperCase())}n=y.getKeys(),r=s[n],r&&(t.preventDefault(),t.stopPropagation(),h&&o(r),r.callback(t,arguments))},!1)};return u}(e,t,n,r)});